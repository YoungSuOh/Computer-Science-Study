# Kernel & User Mode

- 커널 모드(Kernel Mode)와 유저 모드(User Mode)는 현대 운영 체제에서 프로세스가 CPU를 사용할 수 있는 **권한 수준**을 나눈 두 가지 실행 모드이다.
<br><br><br>
## 커널 모드(Kernel Mode)

- **운영 체제의 핵심 코드**(커널)가 실행되는 모드로, **최고 권한**을 가짐
- 하드웨어 자원(CPU, 메모리, 디스크 등)에 **직접 접근**하고 제어 가능
- 모든 명령어 실행이 허용되며, 제한 없이 하드웨어와 통신할 수 있음
<br><br><br>
### 특징

- **무제한 권한**
    - CPU의 모든 명령어와 메모리 주소 접근 가능.
    - 하드웨어 제어, 장치 드라이버 관리, 시스템 자원 관리 등 수행.
- **안정성 중요**
    - 커널 코드에서 발생한 오류는 시스템 전체에 영향을 미쳐 **시스템 크래시**로 이어질 수 있음.
- **운영 체제 코어 실행**
    - 커널 작업(시스템 콜 처리, 인터럽트 처리 등)은 커널 모드에서 실행됨.
<br><br><br>
### **예시**

- 파일 시스템, 메모리 관리, 네트워크 스택, 장치 드라이버 실행.
<br><br><br>
## 유저 모드(User Mode)

### **개념**

- **일반 사용자 프로세스**가 실행되는 모드로, **제한된 권한**만 가짐.
- 하드웨어에 직접 접근할 수 없고, **시스템 콜(System Call)** 을 통해 커널에 요청.

### **특징**

- **제한된 권한**:
    - 하드웨어와 직접 통신하거나 특정 메모리 영역을 접근할 수 없음.
    - 커널 모드에 비해 실행 가능한 명령어가 제한됨.
- **안전성 확보**:
    - 한 유저 모드 프로세스에서 발생한 오류는 **다른 프로세스나 시스템 전체에 영향을 미치지 않음**.
- **커널과의 통신 필요**:
    - 시스템 리소스(파일, 네트워크 등)를 사용하려면 반드시 커널에 요청해야 함

### **예시**

- 웹 브라우저, 사용자 애플리케이션 등.
<br><br><br>
## 커널 모드와 유저 모드의 전환

### 시스템 콜(System Call)

- **유저 모드 → 커널 모드로 전환**하는 주요 메커니즘.
- 유저 모드 프로세스가 커널의 서비스를 요청할 때 사용.
- 전환 과정
    1. 유저 모드 프로세스가 시스템 콜을 호출
    2. CPU는 **커널 모드로 전환**
    3. 요청된 작업 수행 후 다시 **유저 모드로 복귀**

```c
#include <stdio.h>
#include <unistd.h>

int main() {
    printf("This is a user mode process.\n");
    // 시스템 콜: 파일 디스크립터 1에 문자열 쓰기 (write는 커널 모드에서 처리)
    write(1, "Hello, Kernel Mode!\n", 20);
    return 0;
}

```

### 인터럽트와 컨텍스트 스위치

- **하드웨어 인터럽트**
    - I/O 장치 요청 등으로 인해 유저 모드 실행 중 커널 모드로 전환
- **컨텍스트 스위치**
    - 스케줄러에 의해 실행 중인 프로세스가 변경될 때 발생
    - 현재 프로세스 상태를 저장하고, 다른 프로세스 상태를 복원
