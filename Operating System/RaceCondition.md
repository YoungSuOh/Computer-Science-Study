#  RaceCondition

> 공유 자원에 대해 여러 프로세스가 동시에 접근할 때, 결과 값에 영향을 줄 수 있는 상태
> 

## 발생하는 경우

1. 커널 작업을 수행하는 중에 인터럽트 발생
    - 문제 상황
        - 프로세스가 커널 모드에서 공유 데이터를 로드해 작업 수행 중, **하드웨어 인터럽트**가 발생
        - 인터럽트 핸들러가 실행되면서 같은 공유 데이터를 조작
        - 결과적으로, **예상치 못한 데이터 손상**이 발생
    - 해결 방법
        - 인터럽트 비활성화
            - 커널 모드에서 중요한 작업 중에는 **인터럽트를 비활성화**하여 CPU 제어권을 빼앗기지 않도록 설정
        - 원자적 연산(Atomic Operation)
            - 공유 데이터에 대한 작업을 **원자적 연산**으로 처리해 작업 중간에 인터럽트가 발생하지 않도록 보장
2. 프로세스가 `System Call` 을 하여 커널모드로 진입하여 작업을 수행하는 도중 `context swtich` 가 발생했을 때
    - 문제 상황
        - 프로세스1이 커널 모드에서 공유 데이터를 조작 중 **시간 초과로 Context Switch**가 발생
        - 프로세스2가 같은 데이터를 조작하여 **데이터 불일치**가 발생
    - 해결 방법
        - 커널 모드에서는 시간 초과 방지
            - 커널 모드에서 작업 중에는 **시간 초과로 CPU 제어권을 넘기지 않도록 설정**
        - 락(Lock) 기반 동기화
            - 공유 데이터에 대해 락을 설정하여 **한 번에 한 프로세스만 접근**할 수 있도록 제한
3. 멀티 프로세서 환경에서 공유 메모리 내의 커널 데이터에 접근할 때
    - 문제 상황
        - 두 개 이상의 CPU가 **동시에 공유 메모리의 데이터를 수정**하려 할 때, 데이터 손상 발생
        - 예시: CPU1이 공유 변수 `count`를 증가시키는 도중, CPU2가 같은 변수를 감소시키는 작업 수행.
    - 해결 방법
        - **락(Lock)/언락(Unlock)**:
            - 공유 데이터를 사용할 때마다 **락(Lock)** 을 걸고, 작업이 끝나면 **언락(Unlock)** 수행.
        - **스핀락(Spinlock)**:
            - 멀티 프로세서 환경에서는 **스핀락**을 사용하여 CPU가 락을 기다리는 동안 계속 실행 상태를 유지.
        - **CAS(Compare-And-Swap)**:
            - 하드웨어에서 제공하는 CAS 명령어를 사용하여 **공유 자원에 대한 작업을 원자적으로 처리**.